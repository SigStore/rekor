/*
Copyright Â© 2020 Bob Callaway <bcallawa@redhat.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

package types

import (
	"context"
	"encoding/base64"
	"encoding/json"
	"errors"
	"net/http"
	"net/http/httptest"
	"reflect"
	"strings"
	"testing"

	"go.uber.org/goleak"
)

func TestMain(m *testing.M) {
	goleak.VerifyTestMain(m)
}

type BadReader struct {
}

func (br BadReader) Read(p []byte) (n int, err error) {
	return 0, errors.New("test error")
}

func TestRekorLeaf(t *testing.T) {

	type Test struct {
		caseDesc      string
		json          string
		expectSuccess bool
	}

	tests := []Test{
		{
			caseDesc: "Valid full entry",
			json: `{
				"URL": "https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.8.9.tar.gz",
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			expectSuccess: true,
		},
		{
			caseDesc: "Valid full leaf",
			json: `{
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			expectSuccess: true,
		},
		{
			caseDesc: "Valid leaf without SHA",
			json: `{
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			expectSuccess: true,
		},
		{
			caseDesc: "Invalid SHA",
			json: `{
				"SHA": "not_a_valid_sha_hash!!!",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			expectSuccess: false,
		},
		{
			caseDesc: "Invalid signature",
			json: `{
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "not_a_sig",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			expectSuccess: false,
		},
		{
			caseDesc: "Invalid public key",
			json: `{
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "c29tZV9kYXRhCg=="
			}`,
			expectSuccess: false,
		},
		{
			caseDesc: "Missing signature",
			json: `{
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			expectSuccess: false,
		},
		{
			caseDesc: "Missing public key",
			json: `{
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
			}`,
			expectSuccess: false,
		},
		{
			caseDesc:      "Invalid JSON",
			json:          `This is not valid JSON!`,
			expectSuccess: false,
		},
		{
			caseDesc:      "Empty JSON",
			json:          `{}`,
			expectSuccess: false,
		},
	}

	for _, tc := range tests {
		leaf, err := ParseRekorLeaf(strings.NewReader(tc.json))
		if (err == nil) != tc.expectSuccess {
			t.Errorf("Error in test case '%v': %v", tc.caseDesc, err)
		}

		if tc.expectSuccess == true {
			jsonMap := make(map[string]string)
			err := json.Unmarshal([]byte(tc.json), &jsonMap)
			if err != nil {
				t.Errorf("Error in test case '%v' comparing leaf to input: %v", tc.caseDesc, err)
			}
			for key, val := range jsonMap {
				if key == "SHA" {
					if val != reflect.Indirect(reflect.ValueOf(leaf)).FieldByName(key).String() {
						t.Errorf("Error in test case '%v': leaf does not reflect input for '%v'", tc.caseDesc, key)
					}
				} else if key == "Signature" || key == "PublicKey" {
					leafVal := base64.StdEncoding.EncodeToString(reflect.Indirect(reflect.ValueOf(leaf)).FieldByName(key).Bytes())
					if val != leafVal {
						t.Errorf("Error in test case '%v': leaf does not reflect input for '%v' %v != %v", tc.caseDesc, key, val, leafVal)
					}
				}
			}
		}
	}

	if _, err := ParseRekorLeaf(&BadReader{}); err == nil {
		t.Errorf("No error thrown if io.Reader failed")
	}
}

func TestRekorEntry(t *testing.T) {
	type Test struct {
		caseDesc      string
		json          string
		leaf          *RekorLeaf
		expectSuccess bool
	}

	tests := []Test{
		{
			caseDesc: "Valid full entry with URL & SHA",
			json: `{
				"URL": "https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.8.9.tar.gz",
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			leaf:          nil,
			expectSuccess: true,
		},
		{
			caseDesc: "Valid full entry with Data",
			json: `{
				"Data": "c29tZV9kYXRhCg==",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			leaf:          nil,
			expectSuccess: true,
		},
		{
			caseDesc: "Invalid entry without URL or Data",
			json: `{
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			leaf:          nil,
			expectSuccess: false,
		},
		{
			caseDesc: "Invalid entry with URL but no SHA",
			json: `{
				"URL": "https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.8.9.tar.gz",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			leaf:          nil,
			expectSuccess: false,
		},
		{
			caseDesc: "Invalid entry with bad URL",
			json: `{
				"URL": "not_a_url",
				"SHA": "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			leaf:          nil,
			expectSuccess: false,
		},
		{
			caseDesc: "Valid entry but empty leaf",
			json: `{
				"URL": "https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.8.9.tar.gz",
				"Signature": "LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K",
				"PublicKey": "LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg=="
			}`,
			leaf:          &RekorLeaf{},
			expectSuccess: false,
		},
	}

	for _, tc := range tests {
		if tc.leaf == nil {
			leaf, err := ParseRekorLeaf(strings.NewReader(tc.json))
			if err != nil {
				t.Errorf("unexpected error in '%v': %v", tc.caseDesc, err)
			}
			tc.leaf = &leaf
		}

		if _, err := ParseRekorEntry(strings.NewReader(tc.json), *(tc.leaf)); (err == nil) != tc.expectSuccess {
			t.Errorf("Error in test case '%v': %v", tc.caseDesc, err)
		}
	}

	if _, err := ParseRekorEntry(&BadReader{}, RekorLeaf{}); err == nil {
		t.Errorf("No error thrown if io.Reader failed")
	}

	// valid leaf, invalid JSON
	leaf, err := ParseRekorLeaf(strings.NewReader(tests[0].json))
	if err != nil {
		t.Errorf("unexpected error in '%v': %v", tests[0].caseDesc, err)
	}

	if _, err := ParseRekorEntry(strings.NewReader("not json"), leaf); err == nil {
		t.Errorf("No error thrown for invalid JSON but valid leaf")
	}
}

func TestRekorLoad(t *testing.T) {
	type Test struct {
		caseDesc      string
		entry         *RekorEntry
		expectSuccess bool
	}

	invalidFile := []byte("doesn't match")

	validSHA := "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f"
	validSig, _ := base64.StdEncoding.DecodeString("LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K")
	validPublicKey, _ := base64.StdEncoding.DecodeString("LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg==")
	mismatchedSHA := "1ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f"

	smallValidFile := []byte("hello rekor\n")
	gzipValidFile, _ := base64.StdEncoding.DecodeString("H4sIAAAAAAAA/8pIzcnJVyhKzc4v4gIEAAD//6ShuoYMAAAA")
	smallValidSHA := "45c7b11fcbf07dec1694adecd8c5b85770a12a6c8dfdcf2580a2db0c47c31779"
	smallValidSig, _ := base64.StdEncoding.DecodeString("iQHKBAABCAA0FiEEcgCUXG78adj6hGUJJrfBoJ04pHoFAl+86RwWHGxoaW5kc0Bwcm90b25tYWlsLmNvbQAKCRAmt8GgnTikejcHC/9yyGEPh2D+MnNR8I8w0sfWChc6pGAQoS6qk/sfC/9GvF4OC7RIy6OwLr/lxyEZbOP2ngYjh/s5KjKxhZyApwwg13LmcbazGnXc3E76J55LoTfwoRa9fupH/M6HI56VFKwnu+AbMNW1s+DM47r7i5nIN6IX9kMpDe3B9XTUULff/yNUv0XtXU+VAf8ndF1w117YVWxf8TnU/HWvX74URQPN+syuyqK/NO1H1KhBVTzcIYd5H6kJu300jgkDypyyqQpd/pJYVwfeY8fCOaeCpfIPjKQ/4enCsAeBgKsAwfIbor8WiE86KoANYqROaW7uqiN+VPadbWVeN6bMpRIdEq8+NKQGlepSCRqbkVg4VKGOPgB3h5WbY9U1O1FVDnXyt7kWdEPEZjBX+V4DawshvNe5LIyqH5hJ1QNAFd0UStqKQt8EUZ/gAtQiXSGbxM1ACoYL9HblKW5b+kj/onKghekFoCoAfhMwRRqR5g/TS/Pc2/ztwYTIuhpQQfMXziTm64g=")
	smallValidPublicKey, _ := base64.StdEncoding.DecodeString("LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUdOQkYrY0lNMEJEQUNhOEc3UkQydjNtaXdNdHhWYVppM0pCVnVlVkFxSEtDNGVLb01TNUhNQ1JvK0haVlJBCjcwWG1zVHBYMVoxZ1pRdXVDMEdEWTI2aEJoZWpBcTNoeDJydjYvOHE5MEJ2V0dIOXRWZUdwTDFzYUltNTJnRVIKWHlWZ2d6NWtBQzBTNnZNbjdkcjJldEJrV1dQK09qMDVTMDJZWkJUWWd4cE9ieWVjVVNjcUtOVGpzbFpRQkgyZApTSHVrM28yWjdoTTQ5VTBsN3piV3c0b0lUK2xBUmNzYWpRVHdXamxpYVBEL0hSalQyblJPaEloaXRlZC93Z3l6CnlkSXE1ZTZzMThWTGNUNzVxV25yWlhOUFdGd2YyNVJYWTN1dGtXK0dXNW5RZU44MFEya1JFZ2t4RnM1QWQ1V1oKdkU3dDgvaHg1em1zbFo0dGZGNHNpM1FaZUlRQmFjWWJ3eE1QU0RmOW9GR3hkR0ZUODg5d0pMR2dXbXIxVGtQTQpjTjA2d3hBUkd0eE4wejYxRkpUaWpMV1JialczdW5JOWhjUWNVbE4vUSsxNm90SHBlS1ZnNG9XMDBDcnZXT0Q2CnFrTGNNRDQ5eVVEOGZTR0IrUkVuaUJhODlDOWtRVTRTS2Rnc0xML1ErSksrU3k5S21JRHJtMWE0RGZQMXBzZmUKTGphcnpzVlpmS1VIZndjQUVRRUFBYlFpVEhWclpTQklhVzVrY3lBOGJHaHBibVJ6UUhCeWIzUnZibTFoYVd3dQpZMjl0UG9rQjFBUVRBUWdBUGhZaEJISUFsRnh1L0duWStvUmxDU2Ezd2FDZE9LUjZCUUpmbkNETkFoc0RCUWtECndtY0FCUXNKQ0FjQ0JoVUtDUWdMQWdRV0FnTUJBaDRCQWhlQUFBb0pFQ2Ezd2FDZE9LUjZaMWtMLzFJSzB2ZGUKWlg1cjVTZWJOeFRJTlNBQXZZa3JLUnlKNWY3bE9NOWdMR0l1YzJGb05VbmpWUVQwcklHOTAxOWg0OHBDeTkxZgpYakREUk1ZOWd6RldXQ2dHblhoMWhXSTNNN0JKRjZZRTZ1NkRYR3N2dVVwR3JOZVpBRzZra2F6QXVBbm5WMGtDCjA4em9SckFaQ3ZscGFacnlkOGl0YityVitRS3A3QXcybEFJSDFlNmR3TTRSTEZqdmZrOExKWHhqSkFvUG13NmwKTHcxOGM3b1c2UkxPOVFYUThlTTZyMnZISHBtMFR1ZHZaeWFmTnVDMzJHRGxNWTR1MFYxRGI4THN5bVBzQWh1QQoySno0L0tQcTZ1S3dJdG1WSzRwbmRmRUR1NkQxVG9vRFlYaXB0WWFmZHZVMzNwVVF4d0hvZlRUZkU1elp3MlBlCmxIM25aZHNnSFhHUHhKTExNcU9wVzRDL2NNNlpRVmdZU3RWcjBudlU2NitRalF2c2tVWlIwNmRkRXpuQnBHSnMKdHBtajlBZS9HUlk4RU5uTjkvMkdmRXVydHozZEtOVVpvak15MTUzamNHMFUxenpoMTE1V0o3dDh3SEJ1NFM0cAowZ0UrUkFxeXRBY0laRGQyTlNOcno4VnI5RkU5eCtmYXQ5RVJsYm5kQUJFNWlWOHNLMCtGYW5Xd2dia0JqUVJmCm5DRE5BUXdBdEJvdGhmY1J6cjN4cjNQOXA3UUNNd0t1aW9udk1DbThXZ3dOUzRDcGhxbzVOT3IyaU1qa0xQMEoKb21nSkxWWDVOK2Jydjh5NEg4cllQd0tCMTZvL2hBOEliR2JwWXltM0ZjeWtUd2NiV2J0UFRMRXRkQ1VQTFlURApOQzVMR0pwZzNlODZZZlF0QU42L01uWnlZT21sRHgyV0d0dExkbXNBU0dWdXg2QVZKcUl2K3gwNlVLSkVtSzN0CmpsRVZLeWcxMlJFenllNUlUNnFFU0dwT3pvMllsV1VxSVR3L0FhUFEyWnhVYXh2WUZvVU9jd2djZG5Ia2dzaEkKT245aC9OSFVtUDMyV1F2cWtRTXVVYVBJTlJzQzgzS3ZUREdseWZTSFZGek1hNGhETWhFY1h6NGFjaW5kNVdUZQp6eUxnWmhPYjdjTmVDeDR4Y3J0UEI2VTdCUi9GVkx6TEJsQXp1emppRWhZd0pvM0FPTXFGb1I1bUFxaGx1dE5PCnNzeW9mYnFUZ0diU0xkamJYUC9hRXRnejJNVjluL29jMVNCOEhlWk8vMTdKeWduenJ1SUt5Ky9sT1dPenQralYKVkZwVnloMXVlOGxGN3ltS1I0dHNsK2lJVmJxblB2cE1oTE9JQnFYRm4yZ01Da0dvSkx5N09IbzJXQUVKR2x0MwpTd3BicmpqMUFCRUJBQUdKQWJ3RUdBRUlBQ1lXSVFSeUFKUmNidnhwMlBxRVpRa210OEdnblRpa2VnVUNYNXdnCnpRSWJEQVVKQThKbkFBQUtDUkFtdDhHZ25UaWtlaW5pREFDRUFma1pxLzRScDJhTkE0ZGJvSjdVRlhET2FSa1YKOU1Lb0VaRnFUTU5vdkRMNXhoTWxnbFBQdS9sK2RoVGd4ZGVKOUVWSG9lenRiODk2VS9wT3VCUnNuOVZ0VzRZLwpqZWlXN0V5TlhBZC9PcnZuRmJ4KzdpWExxdXBaSkpGVGkvajlSaFZZTnNtbDdzZWJUUGVCbkdEQTkxcWJDNHhICnBRVkRDdWp4NjlWeE81RTFMU29oQ00rTy81dkxCbThpMW8vbmJGbWJ5N1ZDeUtlUkRmaHRmOW5DODRxc0U5R3EKVTcvTFNpazliZnhNV2JwcTh5a250bVMzYTBzemM0YlZGcGV6QnBtTmIwQVZjQitUbTlnV21FemhpTHM2RktBTgpJbnFOdVh1Qkw5UENhYzcrbVUrYzJtQmdHT1JHZDFkWk8zUkM4OXpGM3hCQlluQ09lNWNBTUZsYzFYR3NsbHNJCmR6ZHJkWHZiTkJ6L2o3MXB1TjhvRlltL1hiVmNpZU8wVGZRaURjVHQ4S2lpUjlUQUQ5L1A1OTNSTWxMT0dTOHAKaHZKYmlGb1pmWEhjbHNaRkhtOERRUWE5NElad1RCOG00Z0JWME0yWFN2ZEhvMzBsc3FqdFphWmlTclJoNHJzaApuMTRwYkFhVGRhS0VQY3Z0dWZiVXVXMElqWWQya3BJVC90Zz0KPU9naHIKLS0tLS1FTkQgUEdQIFBVQkxJQyBLRVkgQkxPQ0stLS0tLQo=")

	testServer := httptest.NewServer(http.HandlerFunc(
		func(w http.ResponseWriter, r *http.Request) {
			if r.URL.Path[1:] == "premature_close" {
				return
			}
			if r.URL.Path[1:] == "not_found" {
				w.WriteHeader(http.StatusNotFound)
				return
			}
			if r.URL.Path[1:] == "invalidFile" {
				w.WriteHeader(http.StatusOK)
				_, _ = w.Write(invalidFile)
			}
			if r.URL.Path[1:] == "smallValidFile" {
				w.WriteHeader(http.StatusOK)
				_, _ = w.Write(smallValidFile)
			}
			if r.URL.Path[1:] == "gzipValidFile" {
				w.WriteHeader(http.StatusOK)
				_, _ = w.Write(gzipValidFile)
			}
		}))
	defer testServer.Close()

	tests := []Test{
		{
			caseDesc:      "Invalid entry",
			entry:         &RekorEntry{},
			expectSuccess: false,
		},
		{
			caseDesc: "Invalid URL",
			entry: &RekorEntry{
				nil,
				"not_a_url",
				RekorLeaf{validSHA, validSig, validPublicKey, nil, nil},
			},
			expectSuccess: false,
		},
		{
			caseDesc: "HTTP Server Closes Prematurely",
			entry: &RekorEntry{
				nil,
				testServer.URL + "/premature_close",
				RekorLeaf{validSHA, validSig, validPublicKey, nil, nil},
			},
			expectSuccess: false,
		},
		{
			caseDesc: "HTTP Server 404 not found",
			entry: &RekorEntry{
				nil,
				testServer.URL + "/not_found",
				RekorLeaf{validSHA, validSig, validPublicKey, nil, nil},
			},
			expectSuccess: false,
		},
		{
			caseDesc: "Valid small file (to test content_type detection lower limit",
			entry: &RekorEntry{
				nil,
				testServer.URL + "/smallValidFile",
				RekorLeaf{smallValidSHA, smallValidSig, smallValidPublicKey, nil, nil},
			},
			expectSuccess: true,
		},
		{
			caseDesc: "Valid file with mismatched SHA value",
			entry: &RekorEntry{
				nil,
				testServer.URL + "/smallValidFile",
				RekorLeaf{mismatchedSHA, smallValidSig, smallValidPublicKey, nil, nil},
			},
			expectSuccess: false,
		},
		{
			caseDesc: "Valid file with failed signature validation",
			entry: &RekorEntry{
				nil,
				testServer.URL + "/invalidFile",
				RekorLeaf{validSHA, validSig, validPublicKey, nil, nil},
			},
			expectSuccess: false,
		},
		{
			caseDesc: "Valid gzipped file",
			entry: &RekorEntry{
				nil,
				testServer.URL + "/gzipValidFile",
				RekorLeaf{smallValidSHA, smallValidSig, smallValidPublicKey, nil, nil},
			},
			expectSuccess: true,
		},
		{
			caseDesc: "Valid file passed in through Data field",
			entry: &RekorEntry{
				smallValidFile,
				"",
				RekorLeaf{"", smallValidSig, smallValidPublicKey, nil, nil},
			},
			expectSuccess: true,
		},
	}

	for _, tc := range tests {
		ctx := context.TODO()
		beforeSHA := tc.entry.SHA
		if err := tc.entry.Load(ctx); (err == nil) != tc.expectSuccess {
			t.Errorf("Error in test case '%v': %v", tc.caseDesc, err)
		}
		if tc.expectSuccess && beforeSHA == "" && tc.entry.SHA == "" {
			t.Errorf("Error in test case '%v': SHA not set after call to Load()", tc.caseDesc)
		}
	}
}

func TestRekorLeafMarshalJSON(t *testing.T) {
	type Test struct {
		caseDesc      string
		leaf          *RekorLeaf
		expectSuccess bool
	}

	validSHA := "0ddda6cfaa85ae5771cbbffc7d1fdbf4cfa6761c7256a642f91533363bf1d06f"
	validSig, _ := base64.StdEncoding.DecodeString("LS0tLS1CRUdJTiBQR1AgU0lHTkFUVVJFLS0tLS0KQ29tbWVudDogVGhpcyBzaWduYXR1cmUgaXMgZm9yIHRoZSAudGFyIHZlcnNpb24gb2YgdGhlIGFyY2hpdmUKQ29tbWVudDogZ2l0IGFyY2hpdmUgLS1mb3JtYXQgdGFyIC0tcHJlZml4PWxpbnV4LTUuOC45LyB2NS44LjkKQ29tbWVudDogZ2l0IHZlcnNpb24gMi4yOC4wCgppUUl6QkFBQkNBQWRGaUVFWkg4b1pVaVU0NzFGY1ptK09OdTl5R0NTYVQ0RkFsOWN2YWdBQ2drUU9OdTl5R0NTCmFUNUMvZy8vWnZweTVMZHZHSUVYdkhIZ2xXck1CZDRPUy9ZYzZzbk84aDBZSWpGcnVIR1RQU3ZlbTZLRzByaEYKdy9McGV2aFhwc0IzUjh1N01LN2VNVG5rYVRkanpGbWhreldHZVptcW1PaWRMaGMrWm5WV012dHNnUjJTRXVPNApWd2Vzb2ZvSlkybmswdXhqNW1CcE1ZNkFsRG9oanlteWZzY3diSVNqNkZobTFpcXlNOGpWV3JxVU40WDZCV2dkCnBVS2ovUWRjcmdkS0FHRkpCMGJVeFEyR2I5aHczWmhrQndQRWNhZ2hKNU53Rm44ZzRJTm96UTY2RTBTbEdTK3cKSVNOZEh1d2x6VVg3WitsaUYvVUpsdkllV1ZSZTl3SUNkZnhRSTJqL2RJK1hqblc0VkNoWkxFU3dJeWxadDhqVwpaeDk2d1dPOHlFUmNrd1NablpWSjdrS3dBdmxRVitlNEQ3NkZZQUUzWURySThsTnFuL1hLTXhrZEpqS2hIVGNNCm8waXc3TVFuM2ZFdWxRNFVEd0c3UGEzTHNKeExxMkRVdkI4bG12bng3OG11VDZKTnVhOVVuYzNFTlptbER6YzcKb0pVcUlLeThkWTZZWFFCTWNNcUpoNUR1UkRWRXdKNm55WVlWMTRzWm1rRzgvV29mUkdReHVvY1JjT1RCQk12SgppZkRRb2IyWVdpRUd0UEpIdHh2VWI5RTZ4YnJoR2lscjJncmRDRHFMUUF3QkZTeWlCSy9Kc1dHTE5aMThnUEF6CmJlMGlYMk5mYUxlQlFKZUE2QjMxZk5TcStndHcvMzRBemVOTnNkT1BuZXlYcXN0OUs1WlpCWnFwMUMvZTljWFcKMS9YTlhWeXUwelp1Mkc2VHFlVFpyT3R4NVM4bEVvUjFpM09yQXN0Z0hGT2FibGRFc0VBPQo9WU14VgotLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS0K")
	validPublicKey, _ := base64.StdEncoding.DecodeString("LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUlOQkU1OHRkVUJFQURZNWlRc29MNGs4bDA2ZE50K3VQMmxIOElQaTE0TTUxL3RPSHNXMVpOYzhJb2swc3RICit1QTh3MExwTjk3VWdOaHN2WEZFa0lLMkpqTGFsYXNVVGlVb0llZVRzaEQ5dCtla0ZCeDVhOVNiTENGbEJyRFMKVHdmaWVLMnhhbHpvbW9MMjJONXp0ajFYYmRMV2g2TlJNNmtLTWVZdmdBR284cDg4NFdKazRwUElKSzZHMHdFdwplOS9URzZpbFJTTE90eHlhRjl5WitGQzFlT0ExUzQ3TGQySzI1WTVHc1FGNWFnd2k3bkVTKzl0VlZCWnA5N2tCCjhJT3ZFTGVpU2lZMHhGWGk2MHlmd0lsSzZ4OWRmY3hzeDVuQ3lycDJxZHFRaVBpTUQwRUpNaXVBNnd5bW9pNVcKWHRtZkNwd2VUQjhUdlc4WTh1cXJ3WUFwem1EbGVCRFRJRFAwdkNZMW85ZWZ0SmNXV01rUktDOWM3Wml5NG5UNgpUem1Wa05YZ3FDOC9CdU9RYnBVN0kvMVZDTW9hNmUrMmE4anJneTV0bzRkR2d1NnhRNmpUeFdidmdEZUI2SGN0CldHcWY4ZjlzNWxTcEg4RDhPWkxET1hLb2xxbkJkNVlySnIwUW1wcTRjQ2NJcXdOQ01iVVJ0c1RwYlcvRWRXbCsKQUt3blN0WFhMSTVPNkhnK200YzNPOFp3YnpjbkFPZ1RKZVBtMlhvaTcxdDlTYkFaWngxL1c3cDYvNTdVR3JYUgpRNFdmaXdwT1BEMHNpRjMzeU8yTDdHN0dtbTR6aDhpZVg4YVM4Z3VxZldGaHVTc0R0YTc3RjJGQjlvekQ5V04wClo1dEpvd2l5M1oxVmt4dlpqWkg4SWJjQjA1eUJCQlY0N0JKeHJQblN1RFQrdzQ1eU5UcVo2bTRWWXdBUkFRQUIKdENaSGNtVm5JRXR5YjJGb0xVaGhjblJ0WVc0Z1BHZHlaV2RyYUVCclpYSnVaV3d1YjNKblBva0NUZ1FUQVFnQQpPQlloQkdSL0tHVklsT085UlhHWnZqamJ2Y2hna21rK0JRSmFIdk5BQWhzREJRc0pDQWNDQmhVSUNRb0xBZ1FXCkFnTUJBaDRCQWhlQUFBb0pFRGpidmNoZ2ttaytUTEVRQUoxVXgvNm4vL2YyakVWQmRXYjEzcVlGQkJ4S0pNTmUKVFU5eVBNZWRRQUFocnQ2OElVMUJ0OCsvbm1aTG0xaVhXT3ZQUTAxOTIxaTNIQnhBTm5iVHFFWVlZV25RSkp5UgpPaXlUdXdZN0hXbGd1UVhsa3hMYTFtYWhWdUZlZTZESE8rTzhJR1U4SU0rUEhkRUwwOGU2MjlzSWx1dTNXR21OClhYSjMwN2o0N1VCdTNRRkE2N1lRN1lCbUNobDdBSEJjU3BLU3BsZ044MnRiQVl0cm01eXdZSE01dU1GaG1idy8KREpwekxkRnNuelJUOUU3UEtoSCtxMU15UG9qR1Q0T3l0ajNEMVFacmhwOHlaK1pwOFRRbmxlWGVCY3pMZnBRUApkdXp1cnFWb21acFd3SVpMSENnQkpSV216Ny9NMGtUREluZFFsZTlMVmNKdEpxYXNyUm1nTDNOc0tyWVlCdytqCkhuQmUyaHA4YXE2VzNEVmFVbWtTZHNocmFuOVpDYUxDcHh0NjJOQWdVa0kvZWcxc1Nsam8xYWVYbUYzM3ltWUkKcHhhdlc1Q0dVWUtscVlSTFVUN2VuNnQvbUZpWUN3UEQyMktPZExTZnN2VkcrcHI0VU5zZlNaZElGK1c5L0ZMVwo3SEpWWkdNSWxkc3JHRnY0bE90cWlYZGJSYWZNdHlsWXcvbVUreGh1OStOc2xSUnJiaTFUbFdTL0JIN1VMWXU5CnpLYWhBcGYxREZSY3J4MFB5dnRsRmxlb0RaYTg4dUlibWNVTzhHelpYRWhlalR2OXZObmJtamd2WXNSeXdGY0oKUGtKL1RPYmZhc3Z2U1U5R1puNmFVMzZZN0dZU1VHakQxYW5MaVVwcjBGS2tydXltcUJkWEhhWEdKNDRHWjhIaApkNVpNVGF2d0VYN0J1UUlOQkU1OHRkVUJFQUN5SWlHLzU0bHN1ak9obndUTGY5aEFWcVM3aFBoV0ZYbEVCcVJvClZ3OXExSVRxUFZLYU1RUS8yT1puT1RtaWJGUzkzOGttRUpYVlJUbWsrejd0Q2RUZVJWeUFYSklMVzA5M29Qa3gKZy9WaUh5Y3VtYVZvd1NuK2l1SDY4RThFYVN3U3FtWVhBUCsvQ3M4UlIza1I0MWVIQkZXVlRhRWJWYWkyTGs1VwozWlpCK2h0bU1ZQW9xTVFINnI3Qm83SU5oRXUxNWVzYzk3bWdSOVF4ViswdGkxeDVBeDU1YUZqazJnMFh2K0lkCmxaeFIzKytzYkNRb0xkckhpYWZkWkNQRzRia2V3bEt6dVpwRVRJWjZmOC9iK3IzTnFuREwvQkRDdXRoWWdXcWgKRFdpb09lbW9QQ0hMbzJxOVdNRnh1NkdJVHJtSWxzYWhxU1ZNSU9mb2Z4M21NT1VQTG50Rk1CendsR1VkZUtjMApBaXNXb0VUSW00cm56cFV1bEVXd25BUnVPSFhSUUxkcjZxcUtTS05PdlpxTVg2cmVqaG9vT2ZYR0wrejBqSHgxCjl1WFZkTlRiUHRrZFhxTzZvcExaRmZ0d2trclAzVkFLM0U4Y3FMN21uU0FGR21RQ2QxNnJFdHhSczJiRDJER0QKVFBYMm1ham54ZXBwaHBnbVVTVERCRWxybG8zUEdaMVFMK0pic2c5Zkw1YksveWZhenRMZHZMT0R5Y3FpUnFNeApGeXdTN2JHZ2xZb2NRUnpHTzBDdjZRdEkwWjRpNlhwNGd3eDJQTytVeUlodDU2NXJVZk9KNTF2VmpUaHVyYm1pCkhBZW9RL3c1a3ErOXEwYURSS1FtdjNrKzE0Z2pzcGhoMHVZRmtmdmVFZGZpZGEwR1czZFUvSUVxdjUwRUpiaVMKQ082TSt3QVJBUUFCaVFJZkJCZ0JBZ0FKQlFKT2ZMWFZBaHNNQUFvSkVEamJ2Y2hna21rK01GTVFBTDdxZFlzcQo1UjNISWRrUjM4YVpoVVFXRFRzTFpxUk1TUWN2aWxNdzJla1l6RTB4eFc4TjJLNUpGd05YREVLR3hkcjA4WnpXCmJPUWRpTjd0cktmd0E5VEhoY1Evekh1YlhtMlhJeVV3Ui9Bd1h5akVjQmNGOTMyeCtGK3pIQ3crbDJEQ0JNKzEKYU5IdDdFOHdsYW1UTnV6WmoyYTRWaDQ5T1MwQ0pZaTNsTHNsK2VMMk1DK3VvWmJ6N2pUNFJMQ0xtbTFSbUdJVgpWbmVHV240WENORmR5eG1QeWljQVdhdUthcGMxVHhDekpNWEx3aG9ZdGZSZzNoZDlXZlBhWmJvRmROdE81Q0l4ClcvdGRlNkYrQlhzNWJ0UVJxWEF2Yk5kbVhmYTRjdHlzeTZzQXFNUUlHMlM3d3NHaG54Q3cwb3BEeVlLUVRyNlkKZFlFd0tWOWRmKzJ0djVIem1HQkZQb2JaNms1dUpPZXBFNjVaVVYvZ2dvTVVObW1kZDNIV2hiUjA4d0RwNTJDVApSSTEwdEFwUk1zU0YxNTZDNThJM0xpM0UwMVc5NURSK3l3S0VmOGRTWm0wZGFKNFNEZ2YwY0JTWEZFOS81cFNSCmJWMUduQmdra2dxUXJTOUIzc0ZOR0s5TGkrVGNlZFl1NlRSdUduQ0NUYlhpczlUek1tbUdTeEUxV1AzcmpXZFEKUDg4bWpTck8yUDBnbTJ1YXVNanBnM1A3SkVpbEVIeis4a1BDb2xPclZKbmxnR242bExqU1BlT2pORVViQ3A4WgpuT0lMbGw4cjFGc0hhNmZnQUdIODNKR1ZPSUJpRVZWaWtyeHVna3lnN05CN1dlVnRYQU4vcGEzTHEraDZTc3M1Ck9lN2hqa2FsamhhcmtCRVRMTktGM1J5bk9jT2ViS000Z3BaVQo9NGNIYQotLS0tLUVORCBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCg==")

	tests := []Test{
		{
			caseDesc: "Valid Leaf",
			leaf: &RekorLeaf{
				validSHA,
				validSig,
				validPublicKey,
				nil,
				nil,
			},
			expectSuccess: true,
		},
		{
			caseDesc: "Invalid Leaf, bad sig",
			leaf: &RekorLeaf{
				validSHA,
				[]byte("not a sig"),
				validPublicKey,
				nil,
				nil,
			},
			expectSuccess: false,
		},
		{
			caseDesc: "Invalid Leaf, bad key",
			leaf: &RekorLeaf{
				validSHA,
				validSig,
				[]byte("not a key"),
				nil,
				nil,
			},
			expectSuccess: false,
		},
		{
			caseDesc:      "Invalid Leaf, empty",
			leaf:          &RekorLeaf{},
			expectSuccess: false,
		},
	}

	for _, tc := range tests {
		_ = tc.leaf.ValidateLeaf()
		jsonOutput, err := json.Marshal(tc.leaf)
		if (err == nil) != tc.expectSuccess {
			t.Errorf("Error in test case '%v': %v", tc.caseDesc, err)
		}
		if tc.expectSuccess {
			var marshalledLeaf RekorLeaf
			if err := json.Unmarshal(jsonOutput, &marshalledLeaf); err != nil {
				t.Errorf("Error in test case '%v': unable to unmarshal JSON returned", tc.caseDesc)
			}
			if tc.leaf.SHA != marshalledLeaf.SHA {
				t.Errorf("Error in test case '%v': output SHA in JSON did not match input", tc.caseDesc)
			}
		}
	}
}
